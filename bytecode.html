<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Strict //EN">
<html>
<head>
<title>Byte Code Generation</title>
<link rel="shortcut icon" href="/image/favicon.ico" >
<link rel="stylesheet" type="text/css" href="/static/v2style.css" >
<!--
<link rel="stylesheet" type="text/css" href="/css/100/basestyle|syntaxhighlighter" >
-->

<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="/doc/ie.css" media="screen">
<![endif]-->


<meta name="description" content="Byte Code Generation in Ebean">

<script type="text/javascript" src="/doc/jslib.js" ></script>
<!--
<script type="text/javascript" src="/jsl/jquery|jquery.corner|mygoo|app|shCore|shBrushJava|shBrushProperty|shBrushSql" ></script>
-->

<script type="text/javascript">
 $(document).ready(function(){
	$(".topic").corner("12px");
	$("a.action").corner("8px hover");
	$("div.example").corner("5px");
	$(".reqrlogin").hide();

	//dp.SyntaxHighlighter.ClipboardSwf = '/flash/clipboard.swf';
	dp.SyntaxHighlighter.HighlightAll('code');

 });
</script>

<!-- component('cn=app.comp.LoginEnable') -->




</head>

<body>
<form action='/bytecode.html' method="post" id="GLOBAL_ACTION">
<input type='hidden' name='_WOGA_CONTROLLER' >
<input type='hidden' name='_WOGA_METHOD' >
<input type='hidden' name='_WOGA_PARAM' >
<input type='hidden' name='_WOGA_RENDER' >
<a id="top"></a>
<div id="headwrap">
<div id="headmax">
<div id="menuuser">
<!-- component('cn=app.comp.UserStatus') -->
</div>
<img id="logo" src="/image/logo-avaje.gif" width="127" height="50" alt="avaje logo">
<div style="clear:both;"></div>
</div>
</div><!-- end of headwrap -->

<div id="head2wrap">
<div id="head2max">
<table summary="layout">
<tr>
<td align="center">
<div id="menutab" style="">
<a id="m0" href="/" class="popmenu"><span>home</span></a>
<a id="m1" href="/ebean/documentation.html" class="popmenu"><span>documentation</span></a>
<a id="m4" href="/download.html" class="popmenu"><span>downloads</span></a>
<a id="m6" href="http://groups.google.com/group/ebean" class="popmenu"><span>google group</span></a>
<a id="m2" href="/forum.html" class="popmenu"><span>forums<img src="/image/menuDownH6_3.gif" width="11" height="11" alt=""></span></a>
<a id="m3" href="/bug.html" class="popmenu"><span>bugs<img src="/image/menuDownH6_3.gif" width="11" height="11" alt=""></span></a>
<a id="m5" href="/feedback.html" class="popmenu"><span>feedback</span></a>
</div>
</td>
</tr>
</table>
</div>
</div>

<div id="bodywrap">
<div id="bodymax">
<div id="content">
<div id="pageBody">
<div id="breadcrumb">
<img src="/image/smallhome.gif"> <a href="/">Home</a>
&raquo; <a href="whitepaper.html" title="Whitepapers">Whitepapers</a>
&raquo; <span>Byte Code Generation</span>
</div>





<table>
<tr>
<td class="main">
<h3>Byte Code Generation</h3>

<ul>
<li><a href="#asm">ASM - asm.objectweb.org</a></li>
<li><a href="#subclass">Dynamically generated subclasses</a></li>
<li><a href="#vanilla">"Vanilla" Beans and "Dynamically generated subclass"</a></li>
<li><a href="#lazy">Method Interception for Lazy Loading</a></li>
<li><a href="#occ">Method Interception for Optimistic Concurrency Checking</a></li>
<li><a href="#equals">equals and hashcode</a></li>
<li><a href="#reflection">Reflection Replacement</a></li>
</ul>
<p>
&nbsp;
</p>

<h4><a id="asm"></a><a href="http://asm.objectweb.org/">ASM - asm.objectweb.org</a></h4>
<p>
The ASM library has been used exclusively to provide all the byte code generation.
I have no hesitation in recommending as ASM. It is especially good for Developers
wanting complete control over the generated byte code.
</p>

<h4><a id="subclass"></a>Dynamically generated subclasses</h4>
<pre>
<code>
package app.data;
..
@Entity
class Order {
...
}

...

  Order order = (Order)Ebean.find(Order.class, 10);

  // classname = "app.data.Order$$EntityBean"
  String className = order.getClass().getName();
</code>
</pre>
<p>
When you get a Reference/Proxy or a Bean back from a query what you are actually
getting is a "Dynamically generated subclass".
</p>
<p>
In the case of app.data.Order there is a dynamically created class called
Order$$EntityBean which extends Order and implements the EntityBean interface.
</p>
<pre>
<code>
package app.data;
..
class Order$$EntityBean extends Order implements EntityBean {
...
}
</code>
</pre>
<em>Not really "Byte code Enhancement"</em>
<p>
This is not done via java instrumentation nor by modifying the classloading.
If one of these techniques where used then you could "enhance" the byte code for
actual Order class itself. This is why I will try to avoid describing these 
special beans as "byte code enhanced".
</p>
<p>
Its important to note that Ebean is actually creating a second Class with a
$$EntityBean suffix.
</p>
</td>
<td class="rhslinks">
<div>
<h5>Related Links</h5>
<ul>
<li><a href="occ.html" title="Explanation of Optimistic Concurrency Checking">Optimistic Concurrency Checking</a></li>
<li><a href="transiso.html">Transaction Isolation</a></li>
<li><a href="design.html" title="How Lazy Loading works">Lazy Loading</a></li>
<li><a href="equals.html" >equals and hashcode</a></li>
</ul>
</div>
</td>
</tr>

<tr>
<td class="main">

<h4><a id="vanilla"></a>"Vanilla" Beans and "Dynamically generated subclass"</h4>
<pre>
<code>
  // this is a "Vanilla" Bean
  Order orderVanilla = new Order();

  // orderRef is a "Dynamically generated subclass"
  Order orderRef = (Order)Ebean.getReference(Order.class, 23);

  // It implements the EntityBean interface
  EntityBean orderEb = (EntityBean)orderRef;
</code>
</pre>
<p>
I have not used the term POJO as I believe some people may well consider orderRef a POJO.
In the documentation I am going to refer to plain ordinary beans as "Vanilla" as compared
with orderRef (in the example above) which is best described as a "Dynamically generated subclass".
</p>
<p>
Note: As the "Dynamically generated subclasses" implement the EntityBean interface they are often
refered to in the source code as EntityBean's.
</p>

<h4><a id="lazy"></a>Method Interception for Lazy Loading</h4>
<p>
One of the core demands for using byte code generation is to use method interception
to provide lazy loading for reference/proxy beans.
</p>
<pre>
<code>
  Order orderRef = (Order)Ebean.getReference(Order.class, 23);

  // getting the Id will NOT invoke lazy loading
  orderRef.getId();

  // any call to a "getter" or "setter" on a non-transient
  // property will invoke lazy loading
  Customer cust = orderRef.getCustomer();
</code>
</pre>
<p>
In the code above the customer is a non-transient property. The getter method is
intercepted and the lazy loading of the bean is invoked.
</p>
<p>
The lazy loading will fetch the data for the bean and copy in the non-transient property
values into the bean before returning the customer object.
</p>

<h4><a id="occ"></a>Method Interception for Optimistic Concurrency Checking</h4>
<p>
The other core demand of method interception of beans in Ebean is to detect when a
bean is being modified and keep its "Old/Original Values". The "Old Values" is 
used to perform <a href="occ.html#all">Optimistic Concurrency checking</a> 
for Beans that do not have a Version property.
</p>
<p>
There is a <a href="occcode.html">code example</a> which can perhaps explain the
creation of "Old Values" and setter interception.
</p>

<h4><a id="equals"></a>equals and hashcode</h4>
<p>
In addition a <a href="equals.html">equals and hashcode implementation</a> can be generated and the issues
surrounding this is discussed <a href="equals.html">here</a>.
</p>

<h4><a id="reflection"></a>Reflection Replacement</h4>
<p>
Another use of Byte code generation is to generate code to replace standard reflection.
Obviously getter and setter methods are used a lot in ORM and ASM is used to generate
code to replace the use of Reflection for performance reasons.
</p>
</td>
<td class="rhs">
</td>
</tr>



</table>


</div>
</div>
</div>
</div><!-- end of bodywrap -->

<div id="footwrap">
<div id="footmax">
<div id="foot">
<a href="/">home</a> | <a href="#top">back to top</a>
</div>
</div>
</div><!-- end of footwrap -->

<!-- layers -->
<div id="m1popxxx" class="popmenuchild">
<a href="/ebean/introduction.html">Introduction</a>
<a href="/doc/ebean-userguide.pdf">User Guide (pdf)</a>
<a href="/configure.html">Install/Configure</a>
<a href="/static/javadoc/pub/index.html">Public JavaDoc</a>
<a href="/whitepaper.html">Whitepapers</a>
</div>

<div id="m2pop" class="popmenuchild">
<a href="/forumdetail-1.html">General</a>
<a href="/forumdetail-2.html">Database Specific</a>
<a href="/forumdetail-3.html">Byte Code</a>
<a href="/forumdetail-4.html">Deployment Annotations</a>
<a href="/forumdetail-5.html">Features</a>
</div>

<div id="m3pop" class="popmenuchild">
<a href="/bug.html">Top Bugs</a>
<a href="/enh.html">Top Enhancements</a>
</div>


<div id="woResponse">woResponse</div>

</form>

<div id="woFocusDelay"></div>
</body>
</html>
